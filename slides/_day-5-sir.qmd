# SIR Models


## Classic SIR

:::: {.columns}
::: {.column width="45%"}
How do diseases spread through a population?

- Divide the population into three "compartments"<br>**[S]{.kn-pink}usceptible**, **[I]{.kn-pink}nfected**, **[R]{.kn-pink}ecovered/Removed**
- Model the movement of people in and out of the compartments over time
- Traditionally done with differential equations

<br>

$$
\begin{align}
\frac{{dS}}{{dt}} &= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &= bI
\end{align}
$$
:::

::: {.column width="10%"}
:::

::: {.column width="45%" .fragment}

Don't worry if you're calculus is rusty! A **derivative** describes how one quantity changes in response to another quantity. 

$$\frac{{d}}{{dt}}$$ 

is the derivative with respect to time, which represents the **rate of change** for a quantity given another quantity.

<br>

- $\frac{{dS}}{{dt}}$ changes in the [s]{.kn-pink}**usceptible** compartment over time
- $\frac{{dI}}{{dt}}$ changes in the [i]{.kn-pink}**nfected** compartment over time
- $\frac{{dR}}{{dt}}$ changes in the [r]{.kn-pink}**ecovered** compartment over time
:::
::::


## Classic SIR

:::: {.columns}
::: {.column width="45%"}
How do diseases spread through a population?

- Divide the population into three "compartments"<br>**[S]{.kn-pink}usceptible**, **[I]{.kn-pink}nfected**, **[R]{.kn-pink}ecovered/Removed**
- Model the movement of people in and out of the compartments over time
- Traditionally done with differential equations

<br>

$$
\begin{align}
\frac{{dS}}{{dt}} &= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &= bI
\end{align}
$$
:::

::: {.column width="10%"}
:::

::: {.column width="45%"}

#### The Susceptible Compartment

$$
\frac{{dS}}{{dt}} = - \left( \frac{{a}}{{N}}\right)  I S 
$$

- $I S$ means that the more infected people ($I$) and susceptible people ($S$) there are, the more likely it is that susceptible people will become infected.
- $\frac{{a}}{{N}}$ represents the rate at which the disease spreads in the population, where $a$ is a constant that reflects how easily the disease spreads, and $N$ is the size of the population.
- The minus sign indicates that the number of people in this compartment will decrease as they become infected or are removed.
:::
::::




## Classic SIR

:::: {.columns}
::: {.column width="45%"}
How do diseases spread through a population?

- Divide the population into three "compartments"<br>**[S]{.kn-pink}usceptible**, **[I]{.kn-pink}nfected**, **[R]{.kn-pink}ecovered/Removed**
- Model the movement of people in and out of the compartments over time
- Traditionally done with differential equations

<br>

$$
\begin{align}
\frac{{dS}}{{dt}} &= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &= bI
\end{align}
$$
:::

::: {.column width="10%"}
:::

::: {.column width="45%"}

#### The Infected Compartment

$$
\frac{{dI}}{{dt}} = \left( \frac{{a}}{{N}}\right)  I S - b I
$$

- $\left( \frac{{a}}{{N}}\right) I S$ represents the number of people getting infected (i.e., moving from $S$ to $I$).
- $b$ is a constant that reflects how quickly people recover.^[If $R$ is "removed" instead of "recovered" ... there is no recovery.]
- $- b I$ represents the number of people recovering (moving from $I$ to $R$). 
:::
::::


## Classic SIR

:::: {.columns}
::: {.column width="45%"}
How do diseases spread through a population?

- Divide the population into three "compartments"<br>**[S]{.kn-pink}usceptible**, **[I]{.kn-pink}nfected**, **[R]{.kn-pink}ecovered/Removed**
- Model the movement of people in and out of the compartments over time
- Traditionally done with differential equations

<br>

$$
\begin{align}
\frac{{dS}}{{dt}} &= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &= bI
\end{align}
$$
:::

::: {.column width="10%"}
:::

::: {.column width="45%"}

#### The Recovered Compartment

$$
\frac{{dR}}{{dt}} = bI
$$

- $bI$ shows that the number of recovered people increases as infected people recover.
:::
::::

## Classic SIR

<br>

:::: {.columns}
::: {.column width="45%"}
$$
\begin{align}
\frac{{dS}}{{dt}} &= - \left( \frac{{a}}{{N}}\right)  I S \\
\frac{{dI}}{{dt}} &= \left( \frac{{a}}{{N}}\right)  I S - b I \\
\frac{{dR}}{{dt}} &= bI
\end{align}
$$
:::

::: {.column width="10%"}
:::

::: {.column width="45%"}
We're just tracking the number of people in each compartment over time.

- $S$ decreases as people get infected.
- $I$ increases as more people get infected but decreases as they recover.
- $R$ increases as people recover from the infection.
:::
::::

## SIR in Discrete Time

:::: {.columns}
::: {.column width="45%"}
We can represent the same basic model of changes in the number of people in each compartment *in discrete time intervals*. 

$$
\begin{align}
S(t + 1) &= S(t) - \beta S(t)I(t) \\
I(t + 1) &= I(t) + \beta S(t)I(t) - \gamma I(t) \\
R(t + 1) &= R(t) + \gamma I(t)
\end{align}
$$

<br><br>

**Some Model Assumptions** $\longrightarrow$
:::

::: {.column width="10%"}
:::

::: {.column width="45%"}
> These equations define how the relative numbers of susceptible, infected, and recovered individuals change over time, and represent two propositions about disease contagion. [First]{.kn-pink}, that susceptible individuals become infected via contact with infected individuals, at a rate that is proportional to the expected number of interactions between susceptible and infected individuals, tempered by the transmissibility of the infection, $β$. [Second]{.kn-pink}, that infected individuals recover at a constant rate, $γ$. 
>
> <br>
>
An [implicit assumption]{.kn-pink} is that the rate of interactions between individuals in different states is exactly proportional to the frequencies of those states in the population—that is, that the population is [well-mixed]{.kn-pink}.
>
> <br>
>
> @smaldino2023modeling, page 18
:::
::::

## Mixing and Flattening the Curve

<br>

:::: {.columns}
::: {.column width="55%"}
Reducing physical contact reduces the **effective transmission rate** of a disease, which has a big impact on the number of sick people in a population.

![Proportion of infected people in a population over time from two SIR simulations with different transmissability rates. [We'll develop the model this figure comes from later in the lecture.]{.nord-light}](media/sir_compare){width=75% #fig-sir_compare}
:::

::: {.column width="5%"}
:::

::: {.column width="40%"}

<br><br><br>

#### ~{{< var ontario_population >}}M people in Ontario, Canada [(as of 2024)]{.nord-light}

```{python}
#| echo: false
import yaml
with open('_variables.yml', 'r') as file:
    variables = yaml.safe_load(file)
```


- A peak at `{python} variables['results_sir_model_1_max_infected']` in the high-transmissability model  $\approx$ `{python} round(variables['ontario_population'] * variables['results_sir_model_1_max_infected'], 2)`M infected people
- A peak at `{python} variables['results_sir_model_2_max_infected']` in the low-transmissability model  $\approx$ `{python} round(variables['ontario_population'] * variables['results_sir_model_2_max_infected'], 2)`M infected people

A `{python} round(variables['results_sir_model_1_max_infected']-variables['results_sir_model_2_max_infected'], 4)*100`% difference translates to $\approx$ `{python} round(variables['ontario_population']*variables['results_sir_model_1_max_infected'])-round(variables['ontario_population']*variables['results_sir_model_2_max_infected'])`M infected people **at that particular moment in time**.
:::
::::

## Mixing and Flattening the Curve

<br>

:::: {.columns}
::: {.column width="55%"}
![A comparison of three SIR models with identical parameters other than how much distance an agent can move around in our simulated world. More movement = more mixing = more exposures = more infections. But there are some qualifications that will come up a bit later in the lecture.](media/sir_compare_models_3-6.png){width=100% #fig-sir_compare_models_3-6}
:::

::: {.column width="5%"}
:::

::: {.column width="40%"}
Peak infections are slower and lower when agents move less. But we all know this from experience now...

<br>

#### Shared Parameters

- `N` {{< var model_4.N >}} 
- `grid_height` {{< var model_4.grid_height >}} 
- `grid_width` {{< var model_4.grid_width >}} 
- `infection_rate` {{< var model_4.infection_rate >}} 
- `n_initial_infections` {{< var model_4.n_initial_infections >}} 
- `n_iterations` {{< var model_4.n_iterations >}} 
- `recovery_time_range` (7, 14) <!-- Quarto doesn't support tuples or lists; change this later if time -->
:::
::::


## Time, Space, & Interaction


![The space covered by an agent who can take as many as 5 steps is much greater than the space covered by an agent who can only take 1. The grid is toridal.](media/compare_agent_step_sizes.png){width=100% #fig-compare_agent_step_sizes}


## 

:::: {.columns}
::: {.column width="55%"}
![Explanation...](media/compare_agent_networks.png){width=50% #fig-compare_agent_networks}

:::

::: {.column width="5%"}
:::

::: {.column width="40%"}
`Number of nodes` 500
`Number of edges` 105,589
`Average degree` 422.356

<br><br>
WOW.<br>
This is **extensive** mixing.
:::
::::





## SIR, Classic vs. Agent-based

- How does it compare?
- Pros and cons?


## Agent-based SIR

:::: {.columns}
::: {.column width="40%"}
![Don't forget about your conda environment!](media/chatgpt_dependency_hell.png)
:::

::: {.column width="5%"}
:::

::: {.column width="55%"}
#### Your Conda Virtual Environment

From the command line:

```zsh
conda activate gt
```

<br>

#### Package Imports

In your script/notebooks:

```{python}
import networkx as nx
import pandas as pd

import icsspy
import matplotlib.pyplot as plt
import seaborn as sns

icsspy.set_style()
```
:::
::::


## Agent-based SIR

#### Simulating a Population

:::: {.columns}
::: {.column width="55%"}
- Generate a small-world network with 300 nodes
- Each node connected to 4 neighbors with 15% chance of rewiring

```python
population_size = 300
G = nx.watts_strogatz_graph(population_size, 4, 0.15)
G.name = "A Simulated Small World"

layout = nx.nx_pydot.graphviz_layout(G)

fig, ax = plt.subplots(figsize=(12, 12))
nx.draw(G, 
    pos=layout, 
    node_color='gray', 
    edge_color='gray', 
    node_size=100, 
    width=.5)
plt.savefig("media/simulation-0.png", dpi=300)
```
:::

::: {.column width="5%"}
:::

::: {.column width="40%"}
![A simulated "small world" network. **We'll critique and improve this model later in the lecture.**](media/simulation-0.png){width=100% #fig-simulation-0}
:::
::::
